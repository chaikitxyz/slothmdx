---
const { title, desc, duration, updateDate, pubDate, audioUrl, id, slug } = Astro.props;
import PlayIcon from './icons/playIcon.astro';
import PauseIcon from './icons/pauseIcon.astro';

const parsedPublishDate = new Date(pubDate);
const parsedUpdatedDate = updateDate ? new Date(updateDate) : null;
const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
const podcastDate = parsedUpdatedDate 
  ? parsedUpdatedDate.toLocaleDateString('en-US', options) 
  : parsedPublishDate.toLocaleDateString('en-US', options);
---

<div class='episode-card' id={`episode-card-${id}`}>
  <div class='flex justify-center items-center max-w-7xl p-4 gap-4 flex-row'>
    <div class='grow w-full overflow-auto'>
      <h2 class='md:text-xl text-sm font-semibold truncate'>
        <a href={`/podcast/${slug}/`} class='sloth-link' data-astro-prefetch>
          {title}
        </a>
      </h2>
      <input
        id={`seek-slider-${id}`}
        type='range'
        min='0'
        max='0'
        value='0'
        class='range range-xs my-2 flex-grow'
      />
      <p class='text-xs font-medium opacity-60'>
        {duration && duration + ' â€¢ '}
        {podcastDate}
      </p>
      <p class='my-1 text-xs md:text-sm line-clamp-2'>{desc}</p>
    </div>
    <label class='btn btn-circle md:mx-2 swap'>
      <input
        type='checkbox'
        class='card-play-buttons'
        id={`play-button-${id}`}
        data-audio-url={audioUrl}
        aria-label='Play and pause'
      />
      <div class='swap-off'>
        <PauseIcon />
      </div>
      <div class='swap-on'>
        <PlayIcon />
      </div>
    </label>
    <audio id={`audio-player-${id}`} preload="metadata"></audio>
  </div>
  <hr class='my-3 border-base-content opacity-[.15]' />
</div>

<style>
  .swap input {
    display: none;
  }
  .swap-off {
    display: none;
  }
  .swap input:checked ~ .swap-off {
    display: block;
  }
  .swap input:checked ~ .swap-on {
    display: none;
  }
  .card-play-buttons {
    width: 24px;
    height: 24px;
    position: absolute;
    opacity: 0;
  }
  .episode-card {
    position: relative;
  }
  .episode-card .btn-circle {
    position: relative;
  }
  .episode-card .btn-circle .swap-off,
  .episode-card .btn-circle .swap-on {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  .episode-card .btn-circle .swap-off svg,
  .episode-card .btn-circle .swap-on svg {
    width: 24px;
    height: 24px;
  }
  .episode-card:last-child hr {
    display: none;
  }
  .text-center {
    text-align: center;
  }
</style>
